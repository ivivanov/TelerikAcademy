jQuery.webshims.register("track-ui",function(e,t,i,n){"use strict";function a(e,t){var i=!0,n=0,a=e.length;if(a!=t.length)i=!1;else for(;a>n;n++)if(e[n]!=t[n]){i=!1;break}return i}var r=t.cfg.track,o={subtitles:1,captions:1,descriptions:1},s=t.mediaelement,u=function(){return!r.override&&Modernizr.track},l={update:function(i,n){i.activeCues.length?a(i.displayedActiveCues,i.activeCues)||(i.displayedActiveCues=i.activeCues,i.trackDisplay||(i.trackDisplay=e('<div class="cue-display"><span class="description-cues" aria-live="assertive" /></div>').insertAfter(n),this.addEvents(i,n),t.docObserve()),i.hasDirtyTrackDisplay&&n.triggerHandler("forceupdatetrackdisplay"),this.showCues(i)):this.hide(i)},showCues:function(t){var i=e('<span class="cue-wrapper" />');e.each(t.displayedActiveCues,function(n,a){var r=a.id?'id="cue-id-'+a.id+'"':"",o=e('<span class="cue-line"><span '+r+' class="cue" /></span>').find("span").html(a.getCueAsHTML()).end();"descriptions"==a.track.kind?setTimeout(function(){e("span.description-cues",t.trackDisplay).html(o)},0):i.prepend(o)}),e("span.cue-wrapper",t.trackDisplay).remove(),t.trackDisplay.append(i)},addEvents:function(t,i){if(r.positionDisplay){var a,o=function(e){if(t.displayedActiveCues.length||e===!0){t.trackDisplay.css({display:"none"});var n=i.getShadowElement();n.offsetParent();var a=n.innerHeight(),r=n.innerWidth(),o=n.position();t.trackDisplay.css({left:o.left,width:r,height:a-45,top:o.top,display:"block"}),t.trackDisplay.css("fontSize",Math.max(Math.round(a/30),7)),t.hasDirtyTrackDisplay=!1}else t.hasDirtyTrackDisplay=!0},s=function(){clearTimeout(a),a=setTimeout(o,0)},u=function(){o(!0)};i.on("playerdimensionchange mediaelementapichange updatetrackdisplay updatemediaelementdimensions swfstageresize",s),e(n).on("updateshadowdom",s),i.on("forceupdatetrackdisplay",u),u()}},hide:function(t){t.trackDisplay&&t.displayedActiveCues.length&&(t.displayedActiveCues=[],e("span.cue-wrapper",t.trackDisplay).remove(),e("span.description-cues",t.trackDisplay).empty())}};if(e.extend(e.event.customEvent,{updatetrackdisplay:!0,forceupdatetrackdisplay:!0}),s.trackDisplay=l,!s.createCueList){var p={getCueById:function(e){for(var t=null,i=0,n=this.length;n>i;i++)if(this[i].id===e){t=this[i];break}return t}};s.createCueList=function(){return e.extend([],p)}}s.getActiveCue=function(t,i,n,a){t._lastFoundCue||(t._lastFoundCue={index:0,time:0}),!Modernizr.track||r.override||t._shimActiveCues||(t._shimActiveCues=s.createCueList());for(var u,l,p=0;t.shimActiveCues.length>p;p++)l=t.shimActiveCues[p],l.startTime>n||n>l.endTime?(t.shimActiveCues.splice(p,1),p--,l.pauseOnExit&&e(i).pause(),e(t).triggerHandler("cuechange"),e(l).triggerHandler("exit")):"showing"==t.mode&&o[t.kind]&&-1==e.inArray(l,a.activeCues)&&a.activeCues.push(l);for(u=t.cues.length,p=n>t._lastFoundCue.time?t._lastFoundCue.index:0;u>p&&(l=t.cues[p],n>=l.startTime&&l.endTime>=n&&-1==e.inArray(l,t.shimActiveCues)&&(t.shimActiveCues.push(l),"showing"==t.mode&&o[t.kind]&&a.activeCues.push(l),e(t).triggerHandler("cuechange"),e(l).triggerHandler("enter"),t._lastFoundCue.time=n,t._lastFoundCue.index=p),!(l.startTime>n));p++);},u()&&function(){var i,n=function(t){setTimeout(function(){i=!0,e(t).triggerHandler("updatetrackdisplay"),i=!1},9)},a=function(a,r,o){var s,l="_sup"+o,p={prop:{}};p.prop[o]=function(){return!i&&u()&&n(e(this).closest("audio, video")),s.prop[l].apply(this,arguments)},s=t.defineNodeNameProperty(a,r,p)};a("track","track","get"),["audio","video"].forEach(function(e){a(e,"textTracks","get"),a("nodeName","addTextTrack","value")})}(),t.addReady(function(i,n){e("video, audio",i).add(n.filter("video, audio")).filter(function(){return t.implement(this,"trackui")}).each(function(){var i,n,a,r=e(this),o=function(){var e,a;if(n&&i||(n=r.prop("textTracks"),i=t.data(r[0],"mediaelementBase")||t.data(r[0],"mediaelementBase",{}),i.displayedActiveCues||(i.displayedActiveCues=[])),n&&(a=r.prop("currentTime"),a||0===a)){i.activeCues=[];for(var o=0,u=n.length;u>o;o++)e=n[o],"disabled"!=e.mode&&e.cues&&e.cues.length&&s.getActiveCue(e,r,a,i);l.update(i,r)}},p=function(e){clearTimeout(a),e&&"timeupdate"==e.type?(o(),setTimeout(p,90)):a=setTimeout(o,9)},d=function(){r.off(".trackview").on("play.trackview timeupdate.trackview updatetrackdisplay.trackview",p)};u()?r.on("mediaelementapichange trackapichange",function(){!u()||r.is(".nonnative-api-active")?d():(n=r.prop("textTracks"),i=t.data(r[0],"mediaelementBase")||t.data(r[0],"mediaelementBase",{}),e.each(n,function(e,t){t._shimActiveCues&&delete t._shimActiveCues}),l.hide(i),r.unbind(".trackview"))}):d()})})});